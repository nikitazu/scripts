#!/bin/sh

# Each call to this script changes default
# subtitles encoding (utf-8 or cp1251)
# in mplayer settings.

CPFILE=~/.mplayercp
CONFIG=~/.mplayer/config
CONFIGBK=$CONFIG.backup

if [ -f $CPFILE ]; then
    CURRENTCP=`cat $CPFILE`
else
    CURRENTCP=utf8
fi

echo current mplayer codepage is $CURRENTCP

if [ "$CURRENTCP" = "utf8" ]; then
    NEWCP=cp1251
else
    NEWCP=utf8
fi

echo switching mplayer codepage to $NEWCP
echo $NEWCP>$CPFILE

if [ -f $CONFIG ]; then
    echo config found
    cp $CONFIG $CONFIGBK
    
    if grep -q subcp $CONFIG; then
        echo changing subcp in config
        sed "s/$CURRENTCP/$NEWCP/" "$CONFIGBK">$CONFIG
    else
        echo adding subcp to config
        echo "subcp = $NEWCP" >>$CONFIG
    fi

    if grep -q ^ass $CONFIG; then
        echo ass is ok
    else
        echo adding ass to config
        echo "ass = true" >>$CONFIG
    fi
else
    echo config not found, generating
    echo "#Config generated by mplayer-cp" >$CONFIG
    echo "ass = true" >>$CONFIG
    echo "subcp = $NEWCP" >>$CONFIG
fi

echo done, new config is
cat $CONFIG

exit 0

